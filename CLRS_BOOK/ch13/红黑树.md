### Ch13 红黑树

平衡搜索树的一种, 可以保证在最坏情况下, 基本动态集合操作的时间复杂度为$ O(\lg n)$



#### 13.1 红黑树的性质

红黑树通过

- 每个节点上增加一个存储为来表述节点颜色
- 对任何一条从根到叶子的简单路径上各个节点颜色进行约束

确保没有一条路径会比其他路径长出两倍

因而是近似平衡的



满足下述性质

1. 每个节点是红色或黑色
2. 根节点是黑色
3. 每个叶子节点 (NIL) 是黑色
4. 如果一个节点是红色, 则它的两个子节点都是黑色
5. 对每个节点, 从该节点到其所有后代叶节点的简单路径上, 均包含相同数目的黑色节点



**引理 13.1**

> 一棵有 n 个内部节点的红黑树, 高度至多为 $2 \lg (n+1)$



#### 13.2 旋转

在含 n 个关键字的红黑树上, INSERT 和 DELETE 操作运行花费时间为 $O(\lg n)$



###### 左旋

假设存在节点 x, 其右子节点是非 nil 的节点 y

1. 将 y 提到 x 当前位置
2. x 成为 y 的新左子节点
3. y 原本的左子节点成为 x 的右子节点



*逆时针旋转*



###### 右旋

假设存在节点 y, 其左子节点是非 nil 的节点 x

1. 将 x 提到 y 的位置
2. y 成为 x 的新右子节点
3. x 原本的右子节点成为 y 的左子节点



*逆时针旋转*



左旋和右旋是互逆的



#### 13.3 插入

1. 按照一般二叉搜索树节点插入的方式插入节点 z
2. 将 z 着色为红色
3. 校验红黑树性质, 循环修正直到满足红黑树性质



插入后可能破坏的性质:

- 性质2, z 是根节点, 被着成红色
- 性质4, z 的父节点是红色



循环终止: z 的父节点是黑色, 此时只有性质 2 可能破坏, 因此重新着色即可



循环过程

- 如果 z 的叔节点为红色, 则给父节点, 叔节点, 祖父节点重新着色, 并将节点指针上升两层
- 如果 z 的叔节点为黑色, 则:
  - 当 z 的父节点是祖父节点的左子节点时:
    - 如果 z 是右子节点, 则将节点指针上升一层,  并对 z 执行左旋
    - 如果 z 是左子节点, 则改变父节点, 祖父节点的颜色, 并对祖父节点右旋
  - 当 z 的父节点是祖父节点的右子节点时:
    - 如果 z 是左子节点, 则将节点指针上升一层, 并对 z 执行右旋
    - 如果 z 是右子节点, 则改变父节点, 祖父节点的颜色, 并对祖父节点左旋



在 叔, 父不同色的时候, 是否上提一层并旋转: 指针指向的当前节点相对于父节点, 与父节点相对于祖父节点, 在同一侧, 则不需要, 否则需要



#### 13.4 删除