åœ¨ç›®å‰çš„ db-engines æ—¶åºæ•°æ®åº“æ’åä¸­, ç¬¬ä¸€ä½çš„ [influxdb](https://github.com/influxdata/influxdb) å’Œç¬¬ä¸ƒä½çš„ [prometheus](https://github.com/prometheus/prometheus) éƒ½æ˜¯ç”± go å®ç°çš„.

è¿™æ¬¡æˆ‘æ‰“ç®—é˜…è¯»çš„æºç æ˜¯ promethus çš„ç»„ä»¶ [prometheus/tsdb](https://github.com/prometheus/tsdb)



##### æ—¶åºæ•°æ®åº“

é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹, æ—¶åºæ•°æ®åº“ (tsdb) å…¨ç§°ä¸º Time Series Database, é€šå¸¸ä½œä¸ºå„ç±»ç›‘æµ‹, ç›‘æ§ç³»ç»Ÿçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†. é€šå¸¸éœ€è¦æé«˜çš„å†™å…¥é€Ÿåº¦, å°½é‡ç»æµçš„ç©ºé—´å ç”¨, å’Œå°½å¯èƒ½é«˜çš„æ‰¹é‡æ•°æ®æŸ¥è¯¢æ•ˆç‡.

é™¤äº†ä¸Šé¢æåˆ°çš„ influxdb å’Œ prometheus, æ¯”è¾ƒå…¸å‹çš„è¿˜æœ‰ OpenTSDB,  KairosDB ç­‰.



##### æ—¶åºæ•°æ®åº“çš„å­˜å‚¨

å„ç±»æ—¶åºæ•°æ®åº“çš„æ•°æ®ç»“æ„åŸºæœ¬éƒ½ä»¥ tags , timestamp å’Œ value è¿™æ ·ä¸€ç»„æ¦‚å¿µä¸ºæ ¸å¿ƒ, ç§°ä¸ºæ•°æ®ç‚¹, ç±»ä¼¼ä¸€èˆ¬æ•°æ®åº“ä¸­çš„è®°å½•æˆ–æ¡ç›®æ¦‚å¿µ.

æŸ¥è¯¢å¤§å¤šåŸºäºæ—¶é—´æˆ³, å¹¶ä»¥ tags ä½œä¸ºè¾…åŠ©ç­›é€‰é¡¹.

è‡³äºåº•å±‚å­˜å‚¨, åˆ™æœ‰ä¸åŒçš„æµæ´¾, ä¸€ç±»æ˜¯ä½¿ç”¨å·²æœ‰çš„æˆç†Ÿæ•°æ®åº“äº§å“, æ¯”å¦‚ OpenTSDB é»˜è®¤ä½¿ç”¨ HBase, KairosDB åŸºäº Cassandra ç­‰; å¦ä¸€ç±»åˆ™é‡‡ç”¨è‡ªç ”çš„å­˜å‚¨å¼•æ“, æ¯”å¦‚ Influxdb åœ¨  LSM çš„åŸºç¡€ä¸Šé’ˆå¯¹æ—¶åºæ•°æ®çš„ç‰¹æ€§å¼€å‘äº† TSM å­˜å‚¨å¼•æ“ tsm1, è€Œ prometheus/tsdb åˆ™å‚è€ƒäº† facebook çš„ è®ºæ–‡ [Gorilla: A Fast, Scalable, In-Memory Time Series Database](http://www.vldb.org/pvldb/vol8/p1816-teller.pdf)



##### Facebook çš„ Gorilla

Gorilla çš„ æœ€å¤§ç‰¹ç‚¹, æ˜¯å¿«å’Œé«˜å‹ç¼©ç‡.

facebook æ€»ç»“äº†è‡ªèº«æµ·é‡çš„ IT ç³»ç»Ÿç›‘æ§æ•°æ®å¾—å‡ºä»¥ä¸‹ç»“è®º

1. ç›¸é‚»æ•°æ®ç‚¹æ—¶é—´æˆ³çš„å·®å€¼ç›¸å¯¹å›ºå®š, å³ä½¿å˜åŒ–ä¹Ÿä»…åœ¨ä¸€ä¸ªå¾ˆå°çš„èŒƒå›´å†…æµ®åŠ¨;
2. ç›¸é‚»æ•°æ®ç‚¹çš„å€¼å˜åŒ–å¹…åº¦ä¹Ÿå¾ˆå°, ä¸”æœ‰ç›¸å½“æ¯”ä¾‹çš„å€¼å˜åŒ–ä¸º0;
3. çƒ­ç‚¹æ•°æ®æŸ¥è¯¢çš„é¢‘ç‡è¿œè¿œè¶…å‡ºéçƒ­ç‚¹æ•°æ®, ä¸”è¶Šæ˜¯è¿‘æœŸçš„æ•°æ®çƒ­åº¦è¶Šé«˜.



ç»§è€Œæå‡ºäº† Gorilla çš„å­˜å‚¨è®¾è®¡:

- å°†ä¸€æ®µæ—¶é—´çš„æ•°æ®ç‚¹å­˜å‚¨åœ¨ä¸€ä¸ªæ•°æ®å—å†…;
- æ•°æ®å—ä»…ç¬¬ä¸€ä¸ªç‚¹è®°å½•æ—¶é—´æˆ³å’Œå€¼çš„ç»å¯¹å€¼, ä¹‹åæ‰€æœ‰ç‚¹ä»…è®°å½•å…¶å€¼çš„å˜åŒ–æƒ…å†µ.



ä»¥ä¼ ç»Ÿæ—¶åºæ•°æ®ç»“æ„ä¸­, æ•°æ®ç‚¹çš„æ—¶é—´æˆ³å’Œå€¼å‡è®°ä¸º 64 bit çš„å€¼, å…±å ç”¨ 16 Byte ä¸ºå‚ç…§, Gorilla ç–¯ç‹‚åœ°å°†æ¯æ•°æ®ç‚¹çš„å¹³å‡ç©ºé—´å‹ç¼©åˆ°1.37 Byte, ä¸æ­¤åŒæ—¶æ»¡è¶³äº† fb è‡ªèº« 700M æ¯åˆ†é’Ÿçš„æ•°æ®ç‚¹å†™å…¥éœ€æ±‚.



Gorilla çš„ç¼ºç‚¹åˆ™åœ¨æŸ¥è¯¢ä¸Š, å¯¹äºç›®æ ‡æ—¶é—´ç‚¹, éœ€è¦å°†å…¶æ‰€åœ¨çš„æ•°æ®å—æ•´ä¸ªå–å‡º, è¿›è¡Œéå†.

å› æ­¤, facebook å°†å…¶çƒ­ç‚¹æ•°æ®å®Œå…¨æ”¾åœ¨å†…å­˜ä¹‹ä¸­.



facebook å¼€æºäº† Gorilla çš„ C++ å®ç°ç‰ˆæœ¬ [beringei](https://github.com/facebookincubator/beringei).



æ¯”è¾ƒæœ‰è¶£çš„æ˜¯, å›½å†…æœ€æ“…é•¿å¤šæ¡è…¿èµ°è·¯çš„æ•°æ®åº“åŠä¸­é—´ä»¶å·¨å¤´é˜¿é‡Œåœ¨å»å¹´å…ˆåå‘å¸ƒäº†è‡ªå·±çš„æ—¶åºæ•°æ®åº“äº§å“ [TimescaleDB](https://yq.aliyun.com/articles/73537) å’Œ [HiTSDB](https://yq.aliyun.com/articles/162566) . å‰è€…åŸºäº PostgreSQL, è€Œåè€…åŒæ ·åŸºäº Gorilla, å¹¶å£°ç§°æ•°æ®ç‚¹å¹³å‡å†…å­˜å¼€é”€ 2 Byte ä»¥ä¸‹, ä¸”å…·å¤‡ 10M/sec çš„æ•°æ®ç‚¹å†™å…¥èƒ½åŠ›. ç®—ä¸€ç®—, å’Œ Gorilla è®ºæ–‡ä¸­çš„æ•°å­—ç›¸å·®ä¸å¤š.



##### prometheus/tsdb

[prometheus/tsdb](https://github.com/prometheus/tsdb) æ˜¯ prometheus 2.0 ç‰ˆæœ¬èµ·ä½¿ç”¨çš„åº•å±‚å­˜å‚¨, å®ƒçš„æ•°æ®å—ç¼–ç ä¹Ÿä½¿ç”¨äº† facebook çš„ gorilla, å¹¶å…·å¤‡äº†å®Œæ•´çš„æŒä¹…åŒ–æ–¹æ¡ˆ. å› æ­¤æ˜¯æˆ‘é¦–å…ˆæ‹¿æ¥å‚çœ‹çš„é¡¹ç›®.



æºç çš„é˜…è¯»åŸºäº [commit d45b59](https://github.com/prometheus/tsdb/tree/d45b595a1daefad23c09a2d994bf956f8b5f15a9) , å°†ä¼šåˆ†æˆå¤šç¯‡æ–‡ç« .

 æ–‡ç« çš„æ•°é‡, ç¯‡å¹…å’Œé¢‘ç‡, è§†ä¹æˆ‘æ®‹å­˜çš„æ‚Ÿæ€§ ğŸ˜‚.



ä»¥ä¸‹æ˜¯å®ƒçš„é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ Documentation
â”‚Â Â  â””â”€â”€ format
â”‚Â Â      â”œâ”€â”€ chunks.md
â”‚Â Â      â”œâ”€â”€ index.md
â”‚Â Â      â””â”€â”€ tombstones.md
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ block.go
â”œâ”€â”€ block_test.go
â”œâ”€â”€ chunkenc
â”‚Â Â  â”œâ”€â”€ bstream.go
â”‚Â Â  â”œâ”€â”€ chunk.go
â”‚Â Â  â”œâ”€â”€ chunk_test.go
â”‚Â Â  â””â”€â”€ xor.go
â”œâ”€â”€ chunks
â”‚Â Â  â””â”€â”€ chunks.go
â”œâ”€â”€ cmd
â”‚Â Â  â””â”€â”€ tsdb
â”‚Â Â      â”œâ”€â”€ Makefile
â”‚Â Â      â”œâ”€â”€ README.md
â”‚Â Â      â””â”€â”€ main.go
â”œâ”€â”€ compact.go
â”œâ”€â”€ compact_test.go
â”œâ”€â”€ db.go
â”œâ”€â”€ db_test.go
â”œâ”€â”€ encoding_helpers.go
â”œâ”€â”€ fileutil
â”‚Â Â  â”œâ”€â”€ dir_unix.go
â”‚Â Â  â”œâ”€â”€ dir_windows.go
â”‚Â Â  â”œâ”€â”€ fileutil.go
â”‚Â Â  â”œâ”€â”€ mmap.go
â”‚Â Â  â”œâ”€â”€ mmap_unix.go
â”‚Â Â  â”œâ”€â”€ mmap_windows.go
â”‚Â Â  â”œâ”€â”€ preallocate.go
â”‚Â Â  â”œâ”€â”€ preallocate_darwin.go
â”‚Â Â  â”œâ”€â”€ preallocate_linux.go
â”‚Â Â  â”œâ”€â”€ preallocate_other.go
â”‚Â Â  â”œâ”€â”€ sync.go
â”‚Â Â  â”œâ”€â”€ sync_darwin.go
â”‚Â Â  â””â”€â”€ sync_linux.go
â”œâ”€â”€ head.go
â”œâ”€â”€ head_test.go
â”œâ”€â”€ index
â”‚Â Â  â”œâ”€â”€ encoding_helpers.go
â”‚Â Â  â”œâ”€â”€ index.go
â”‚Â Â  â”œâ”€â”€ index_test.go
â”‚Â Â  â”œâ”€â”€ postings.go
â”‚Â Â  â””â”€â”€ postings_test.go
â”œâ”€â”€ labels
â”‚Â Â  â”œâ”€â”€ labels.go
â”‚Â Â  â”œâ”€â”€ labels_test.go
â”‚Â Â  â””â”€â”€ selector.go
â”œâ”€â”€ querier.go
â”œâ”€â”€ querier_test.go
â”œâ”€â”€ test
â”‚Â Â  â”œâ”€â”€ conv_test.go
â”‚Â Â  â”œâ”€â”€ hash_test.go
â”‚Â Â  â””â”€â”€ labels_test.go
â”œâ”€â”€ testdata
â”‚Â Â  â””â”€â”€ 20kseries.json
â”œâ”€â”€ testutil
â”‚Â Â  â””â”€â”€ testutil.go
â”œâ”€â”€ tombstones.go
â”œâ”€â”€ tombstones_test.go
â”œâ”€â”€ tsdbutil
â”‚Â Â  â”œâ”€â”€ buffer.go
â”‚Â Â  â””â”€â”€ buffer_test.go
â”œâ”€â”€ wal.go
â””â”€â”€ wal_test.go
```



##### å‚è€ƒæ–‡ç« 

å…³äºæ—¶åºæ•°æ®åº“åŠå¸¸è§äº§å“çš„è§£è¯», å¯ä»¥å‚è€ƒäº‘æ –ç¤¾åŒºçš„ä¸€ç³»åˆ—æ–‡ç« :

[æ—¶é—´åºåˆ—æ•°æ®çš„å­˜å‚¨å’Œè®¡ç®— - æ¦‚è¿°](https://yq.aliyun.com/articles/104243?spm=5176.100239.0.0.1afb4721uSw5Gf)

[æ—¶é—´åºåˆ—æ•°æ®çš„å­˜å‚¨å’Œè®¡ç®— - å¼€æºæ—¶åºæ•°æ®åº“è§£æï¼ˆä¸€ï¼‰](https://yq.aliyun.com/articles/104246?spm=5176.100239.0.0.1afb4721uSw5Gf)

[æ—¶é—´åºåˆ—æ•°æ®çš„å­˜å‚¨å’Œè®¡ç®— - å¼€æºæ—¶åºæ•°æ®åº“è§£æï¼ˆäºŒï¼‰](https://yq.aliyun.com/articles/106382?spm=5176.100239.0.0.1afb4721uSw5Gf)

[æ—¶é—´åºåˆ—æ•°æ®çš„å­˜å‚¨å’Œè®¡ç®— - å¼€æºæ—¶åºæ•°æ®åº“è§£æï¼ˆä¸‰ï¼‰](https://yq.aliyun.com/articles/158312?spm=5176.100239.0.0.1afb4721uSw5Gf)



